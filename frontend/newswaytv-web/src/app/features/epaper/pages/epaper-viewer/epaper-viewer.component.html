<section class="viewer" *ngIf="!isLoading && pdfUrl; else emptyState">
  <div class="viewer-header">
    <p class="eyebrow">Epaper Viewer</p>
    <h1>{{ epaper?.title }}</h1>
    <p class="meta">{{ epaper?.date }}</p>
    <div class="viewer-actions">
      <button type="button" class="download" (click)="downloadPdf()">Download PDF</button>
      <a class="direct" [href]="pdfUrl" target="_blank" rel="noopener">Direct Link</a>
    </div>
    <!-- <a class="drive-link" href="https://drive.google.com/drive/u/0/folders/1Z-ytveQyLVvV8LQCg98VNSU5jKq9fzzl" target="_blank" rel="noopener">
      Open Google Drive Folder
    </a> -->
  </div>

  <app-pdf-toolbar
    *ngIf="!drivePreviewUrl"
    [pageNumber]="pageNumber"
    [pageCount]="pageCount"
    [zoom]="zoom"
    [minZoom]="minZoom"
    [maxZoom]="maxZoom"
    [isFullscreen]="isFullscreen"
    (nextPage)="nextPage()"
    (prevPage)="prevPage()"
    (zoomIn)="zoomIn()"
    (zoomOut)="zoomOut()"
    (download)="downloadPdf()"
    (toggleFullscreen)="toggleFullscreen()"
  ></app-pdf-toolbar>

  <app-pdf-canvas-viewer
    *ngIf="!drivePreviewUrl"
    [pdfUrl]="pdfUrl"
    [pageNumber]="pageNumber"
    [scale]="zoom"
    (pageCountChange)="onPageCountChange($event)"
  ></app-pdf-canvas-viewer>

  <div class="drive-viewer" *ngIf="drivePreviewSafeUrl">
    <iframe
      [src]="drivePreviewSafeUrl"
      title="Google Drive PDF Viewer"
      allow="autoplay"
    ></iframe>
  </div>

  <div class="page-strip" *ngIf="pageCount > 1 && !drivePreviewUrl">
    <button
      type="button"
      class="page-chip"
      *ngFor="let page of pageNumbers; trackBy: trackByPage"
      [class.active]="page === pageNumber"
      (click)="setPage(page)"
    >
      {{ page }}
    </button>
  </div>
</section>

<ng-template #emptyState>
  <div class="viewer-empty">
    <p *ngIf="isLoading">Loading viewer...</p>
    <p *ngIf="!isLoading">No epaper found for this link.</p>
  </div>
</ng-template>
